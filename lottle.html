<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é—†å¨˜æŠ½çæ± </title>
    
    <!-- å¼•å…¥ Tailwind CSS (æ¨£å¼åº«) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- å¼•å…¥ React å’Œ Babel (æ ¸å¿ƒå¼•æ“) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- å¼•å…¥ Confetti ç‰¹æ•ˆåº« -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        /* é¡å¤–çš„å‹•ç•«å®šç¾© */
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fade-in 0.5s ease-out forwards; }
        
        @keyframes bounce-in {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-bounce-in { animation: bounce-in 0.8s cubic-bezier(0.215, 0.610, 0.355, 1.000) both; }
        
        .text-shadow-lg { text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
    </style>
</head>
<body class="bg-green-900">
    <div id="root"></div>

    <script type="text/babel">
        // å¾å…¨åŸŸ React ç‰©ä»¶ä¸­å–å¾— Hook
        const { useState, useEffect } = React;

        const MahjongLottery = () => {
            const [gameState, setGameState] = useState('home'); // home, drawing, win, lose, limit_reached
            const [drawCount, setDrawCount] = useState(0);
            const MAX_DRAWS = 5;
            const WIN_RATE = 0.2; // 20% ä¸­çç‡

            // åˆå§‹åŒ–ï¼šè®€å–ç”¨æˆ¶å·²æŠ½çæ¬¡æ•¸
            useEffect(() => {
                const savedCount = localStorage.getItem('mahjong_draw_count');
                if (savedCount) {
                    setDrawCount(parseInt(savedCount, 10));
                }
                // HTML ç‰ˆæœ¬ç›´æ¥åœ¨ head å¼•å…¥äº† confettiï¼Œé€™è£¡ä¸éœ€è¦å‹•æ…‹åŠ è¼‰
            }, []);

            // è§¸ç™¼ä¸­çç‰¹æ•ˆ
            const fireConfetti = () => {
                if (window.confetti) {
                    const duration = 3000;
                    const animationEnd = Date.now() + duration;
                    const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };
                    const randomInRange = (min, max) => Math.random() * (max - min) + min;

                    const interval = setInterval(function() {
                        const timeLeft = animationEnd - Date.now();
                        if (timeLeft <= 0) return clearInterval(interval);
                        const particleCount = 50 * (timeLeft / duration);
                        window.confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
                        window.confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
                    }, 250);
                }
            };

            const handleDraw = () => {
                if (drawCount >= MAX_DRAWS) return;

                setGameState('drawing');
                
                // å¢åŠ æ¬¡æ•¸ä¸¦å­˜å…¥ localStorage
                const newCount = drawCount + 1;
                setDrawCount(newCount);
                localStorage.setItem('mahjong_draw_count', newCount);

                // æ¨¡æ“¬æŠ½çéç¨‹ (1.5ç§’)
                setTimeout(() => {
                    const randomValue = Math.random();
                    // åˆ¤æ–·ä¸­ç
                    const isWin = randomValue < WIN_RATE;

                    if (isWin) {
                        setGameState('win');
                        fireConfetti();
                    } else {
                        setGameState('lose');
                    }
                }, 1500);
            };

            const resetGame = () => {
                setGameState('home');
            };

            const resetCount = () => {
                const pwd = window.prompt('è«‹è¼¸å…¥ç®¡ç†å“¡å¯†ç¢¼ä»¥é‡ç½®æ¬¡æ•¸ï¼š');
                if (pwd === '13491349') {
                    setDrawCount(0);
                    localStorage.removeItem('mahjong_draw_count');
                    setGameState('home');
                    alert('æ¬¡æ•¸å·²é‡ç½®æˆåŠŸï¼');
                } else if (pwd !== null) {
                    alert('å¯†ç¢¼éŒ¯èª¤ï¼Œç„¡æ³•é‡ç½®ã€‚');
                }
            };

            // éº»å°‡ç‰Œåœ–æ¨™çµ„ä»¶
            const MahjongTile = ({ symbol, color = "text-red-600", subText }) => (
                <div className="flex flex-col items-center">
                    <div className="w-16 h-20 bg-white rounded-lg shadow-md border-b-4 border-gray-300 flex items-center justify-center relative transform transition hover:-translate-y-1">
                        <div className="absolute inset-0 bg-gradient-to-br from-white to-gray-100 rounded-lg"></div>
                        <span className={`relative text-4xl font-bold ${color} select-none`}>{symbol}</span>
                    </div>
                    {subText && <span className="text-xs text-yellow-500 mt-2 font-bold">{subText}</span>}
                </div>
            );

            return (
                <div className="min-h-screen bg-green-900 flex flex-col items-center justify-center p-4 font-sans text-gray-100 relative overflow-hidden select-none">
                    {/* èƒŒæ™¯è£é£¾ */}
                    <div className="absolute inset-0 opacity-10 pointer-events-none" 
                         style={{ backgroundImage: 'radial-gradient(#ffffff 1px, transparent 1px)', backgroundSize: '20px 20px' }}>
                    </div>

                    <div className="w-full max-w-md bg-green-800/90 backdrop-blur-sm rounded-2xl border-4 border-yellow-600 shadow-2xl p-6 relative z-10 text-center min-h-[500px] flex flex-col justify-center">
                        
                        {/* é é¢é ‚éƒ¨è£é£¾ */}
                        <div className="absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-yellow-600 px-6 py-1 rounded-full shadow-lg border border-yellow-400 w-64">
                           <span className="text-yellow-100 font-bold tracking-widest text-sm block">ğŸ€„ é—†å¨˜åŠ ç¢¼å¤§æ”¾é€ ğŸ€„</span>
                        </div>

                        {/* --- é¦–é  --- */}
                        {gameState === 'home' && (
                            <div className="animate-fade-in space-y-6">
                                <div className="mt-4">
                                    <h1 className="text-3xl font-bold text-yellow-400 drop-shadow-md">æ­¡è¿ä¾†åˆ°<br/>é—†å¨˜æŠ½çæ± </h1>
                                    <p className="text-green-200 text-sm mt-1">ä»Šæ—¥æ‰‹æ°£ï¼š{drawCount >= MAX_DRAWS ? 'æ˜æ—¥è«‹æ—©' : 'æ—ºæ—ºæ—º'}</p>
                                </div>

                                {/* çå“å€ */}
                                <div className="bg-green-900/50 p-6 rounded-xl border border-yellow-600/30 relative overflow-hidden group">
                                    <div className="absolute top-2 right-2 bg-red-600 text-white text-xs font-bold px-2 py-1 rounded shadow animate-pulse">
                                        é™é‡3å¼µ
                                    </div>
                                    <p className="text-gray-300 text-sm mb-2">æœ¬æ¬¡å¤§ç</p>
                                    <div className="py-2 flex justify-center">
                                        <MahjongTile symbol="å…" />
                                    </div>
                                    <h2 className="text-2xl font-bold text-yellow-300 mt-2">å…è²»åŒ…å»‚åˆ¸</h2>
                                </div>

                                {/* æŠ½çæŒ‰éˆ•èˆ‡ç‹€æ…‹ */}
                                <div className="space-y-3">
                                    {drawCount < MAX_DRAWS ? (
                                        <>
                                            <button 
                                                onClick={handleDraw}
                                                className="w-full bg-gradient-to-b from-red-500 to-red-700 hover:from-red-400 hover:to-red-600 text-white text-xl font-bold py-4 rounded-xl shadow-lg transform transition active:scale-95 border-b-4 border-red-900 flex items-center justify-center gap-2"
                                            >
                                                <span>ğŸ²</span> ç«‹å³æŠ½ç 
                                            </button>
                                            <p className="text-sm font-bold text-yellow-200 bg-black/20 py-1 rounded-lg">
                                                å‰©é¤˜æ¬¡æ•¸ï¼š<span className="text-white text-lg">{MAX_DRAWS - drawCount}</span> / {MAX_DRAWS}
                                            </p>
                                        </>
                                    ) : (
                                        <div className="bg-gray-700/80 p-4 rounded-xl border-2 border-gray-500">
                                            <p className="text-gray-300 font-bold text-lg">âš ï¸ ä»Šæ—¥æ¬¡æ•¸å·²ç”¨ç›¡</p>
                                            <p className="text-gray-400 text-sm mt-1">è«‹æ˜æ—¥å†ä¾†æŒ‘æˆ°ï¼</p>
                                            <button 
                                                onClick={resetCount}
                                                className="mt-4 text-xs text-gray-500 underline hover:text-gray-300"
                                            >
                                                (ç®¡ç†å“¡é‡ç½®)
                                            </button>
                                        </div>
                                    )}
                                </div>
                                
                                <p className="text-xs text-green-300/40 mt-2">ä¸­çç‡ 20% â€¢ ç¥æ‚¨è‡ªæ‘¸ä¸€æŠŠç½©</p>
                            </div>
                        )}

                        {/* --- æŠ½çä¸­å‹•ç•« --- */}
                        {gameState === 'drawing' && (
                            <div className="flex flex-col items-center justify-center space-y-6 animate-pulse py-10">
                                <div className="animate-spin text-7xl">ğŸ€„</div>
                                <div>
                                    <h2 className="text-2xl font-bold text-yellow-400">æ´—ç‰Œä¸­...</h2>
                                    <p className="text-green-200 text-sm mt-2">ç¬¬ {drawCount} æ¬¡æŒ‘æˆ°</p>
                                </div>
                            </div>
                        )}

                        {/* --- ä¸­çé é¢ --- */}
                        {gameState === 'win' && (
                            <div className="space-y-6 animate-bounce-in py-4">
                                <div className="text-yellow-400 text-5xl mb-2 animate-bounce">ğŸ‰</div>
                                
                                <div>
                                    <h2 className="text-3xl font-extrabold text-white mb-2 text-shadow-lg">æ­å–œä¸­çï¼</h2>
                                    <div className="my-6 transform scale-110">
                                        <div className="bg-gradient-to-br from-yellow-100 to-yellow-200 border-4 border-yellow-500 text-red-700 p-6 rounded-lg shadow-xl rotate-1 relative">
                                            <div className="absolute top-2 right-2 w-16 h-16 border-2 border-red-600 rounded-full flex items-center justify-center opacity-30 transform -rotate-12">
                                                 <span className="text-red-600 font-black text-xs">é©—è­‰ç« </span>
                                            </div>

                                            <div className="text-sm font-bold border-b border-red-200 pb-2 mb-2">éº»å°‡ç¤¾ç¾¤å¤§ç</div>
                                            <div className="text-3xl font-black tracking-tighter">å…è²»åŒ…å»‚åˆ¸</div>
                                            <div className="text-xs mt-2 text-red-600 font-bold">No. {Date.now().toString().slice(-6)}</div>
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-red-900/60 p-4 rounded-lg border border-red-500/50 backdrop-blur-sm">
                                    <p className="text-yellow-300 font-bold text-lg mb-1 animate-pulse">âš ï¸ è«‹ç«‹å³æˆªåœ–</p>
                                    <p className="text-white text-sm">è«‹å°‡æ­¤ç•«é¢å‚³çµ¦é—†å¨˜å…Œæ›<br/>é›¢é–‹ç•«é¢å¯èƒ½ç„¡æ³•å¾©åŸ</p>
                                </div>

                                <button 
                                    onClick={() => window.location.reload()}
                                    className="mt-2 text-green-300/70 underline text-sm hover:text-white"
                                >
                                    è¿”å›é¦–é 
                                </button>
                            </div>
                        )}

                        {/* --- æ²’ä¸­çé é¢ --- */}
                        {gameState === 'lose' && (
                            <div className="space-y-6 animate-fade-in py-6">
                                <div className="flex justify-center gap-4 mb-4 opacity-90">
                                    <MahjongTile symbol="éŠ˜" color="text-gray-500" />
                                    <MahjongTile symbol="è¬" color="text-gray-500" />
                                </div>
                                
                                <div>
                                    <h2 className="text-3xl font-bold text-gray-300 mb-2">éŠ˜è¬æƒ é¡§</h2>
                                    <p className="text-lg text-yellow-500/80 font-medium">æ‰‹æ°£æ­£åœ¨ç´¯ç©ä¸­...</p>
                                </div>

                                {drawCount < MAX_DRAWS ? (
                                    <>
                                        <p className="text-green-200 text-sm px-8">
                                            åˆ¥æ°£é¤’ï¼Œæ‚¨é‚„æœ‰ <span className="text-yellow-400 font-bold text-lg">{MAX_DRAWS - drawCount}</span> æ¬¡æ©Ÿæœƒï¼
                                        </p>

                                        <button 
                                            onClick={resetGame}
                                            className="w-full bg-green-700 hover:bg-green-600 text-white font-bold py-3 rounded-xl shadow-lg mt-4 border-b-4 border-green-900 transition active:scale-95 flex items-center justify-center gap-2"
                                        >
                                            <span>ğŸ”„</span> å†æŠ½ä¸€æ¬¡
                                        </button>
                                    </>
                                ) : (
                                    <div className="bg-gray-800/60 p-4 rounded-lg border border-gray-600 mt-4">
                                        <p className="text-gray-300">æ¬¡æ•¸å·²å…¨éƒ¨ç”¨å®Œ</p>
                                        <button 
                                            onClick={resetGame}
                                            className="mt-3 text-sm text-green-400 hover:text-green-300 underline"
                                        >
                                            å›é¦–é æŸ¥çœ‹
                                        </button>
                                    </div>
                                )}
                            </div>
                        )}

                    </div>

                    <div className="mt-8 text-green-400/30 text-xs text-center">
                        &copy; {new Date().getFullYear()} é—†å¨˜èœé›èˆ â€¢ åƒ…ä¾›å¨›æ¨‚ â€¢ {drawCount}/{MAX_DRAWS}
                    </div>
                </div>
            );
        };

        // æ¸²æŸ“ App
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MahjongLottery />);
    </script>
</body>
</html>